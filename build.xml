<target name="api-draft" depends="validate">
    <echo message="ðŸ“¦ Creating or Updating draft API ${api.name}:${api.version}..." />

    <!-- List all APIs in the catalog -->
    <exec executable="apic" outputproperty="api.list" failonerror="true">
        <arg value="apis:list-all"/>
        <arg value="--scope"/>
        <arg value="catalog"/>
        <arg value="--catalog"/>
        <arg value="prod"/>
    </exec>

    <!-- Check if the API exists -->
    <condition property="api.exists">
        <contains string="${api.list}" substring="${api.name}:${api.version}" />
    </condition>

    <!-- Call create or update -->
    <antcall target="api-create" unless="api.exists"/>
    <antcall target="api-update" if="api.exists"/>
</target>
